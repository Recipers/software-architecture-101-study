- 모든 아키텍처는 리스크를 갖고 있다. 아키텍처 리스크 분석은 핵심 활동 중 하나로, 리스크를 꾸준히 분석하여 아키텍처의 내부 결함을 바로잡고 리스크를 줄여야 한다.

# 20.1 리스크 매트릭스
- 리스크를 평가할 때에는 먼저 리스크를 낮은, 중간, 높음 정도로 분류할지 결정해야 한다.
  - 리스크 매트릭스를 활용하면 주관성을 낮추고 특정한 아키텍처 영역에서 리스크를 찾아내는데 도움이 된다.

<img width="586" alt="스크린샷 2025-06-25 오후 4 05 36" src="https://github.com/user-attachments/assets/cf73d968-c41c-40c4-ba7e-35661bd5bbe5" />

- 전체 리스크 영향도와 발생 가능성 두 가지 차원으로 리스크를 평가한 뒤 낮음 중간 높음 등급을 매긴 것이다.
- 괄호 안 숫자와 매트릭스 각 그리드의 숫자를 곱하면 리스크를 객관적인 수치로 정량화할 수 있다.
  - 1, 2는 낮은 리스크(밝은 회색) 3, 4는 중간 리스크(중간 회색) 6~9는 높은 리스크(짙은 회색)을 나타낸다.
- 리스크 매트릭스로 리스크를 가늠할 때에는 먼저 영향도 차원을 고려한 다음 발생 가능성 차원을 생각해보자

# 20.2 리스크 평가
- 리스크 매트릭스를 활용하면 리스크 평가를 작성할 수 있다. 리스크 평가는 맥락에 따라 유의미한 평가 기준에 대해 전체 아키텍처 리스크를 요약한 리포트이다.

<img width="586" alt="스크린샷 2025-06-25 오후 4 09 42" src="https://github.com/user-attachments/assets/c8bf327d-38a9-4194-b23d-5527264624cb" />

- 리스크 평가는 천차만별이지만 일반적으로는 애플리케이션 서비스나 도메인 영역에 기반한 평가 기준이 포함된다.
  - 이처럼 리스크 매트릭스로 정량화한 리스크는 평가 기준별로, 서비스 또는 도메인 영역별로 누적치를 계산할 수 있다.
  - 이런식으로 상대적 수치를 비교하면 어떤 리스크 범주나 도메인 영역에서 리스크가 개선됐는지 아니면 반대로 악화됐는지 파악할 수 있다.

<img width="586" alt="스크린샷 2025-06-25 오후 4 12 13" src="https://github.com/user-attachments/assets/8feaa9b7-244f-4127-afe3-b94353a1c9bc" />

- 그림 20-2는 모든 항목의 리스크 분석 결과를 담고 있지만. 주어진 맥락에 맞게 전달하려는 메시지를 표현하려면 필터링이 꼭 필요하다.
  - 아키텍트가 회의에 참석하여 리스크가 높은 시스템 영역을 발표할 경우 그림 20-3처럼 필터링을 거쳐 리스크가 높은 영역만 표시해야 된다.
- 그러나 그림20-2는 특정 시점을 포착한 스냅샷일 뿐, 상황이 좋아지는 추세인지 아닌지는 알 수 없는 리포트이다.

<img width="586" alt="스크린샷 2025-06-25 오후 4 13 58" src="https://github.com/user-attachments/assets/801aaca6-3a50-4613-bd86-b3ebd1ea1191" />

- 따라서 보통 리스크 등급 옆에 플러스, 마이너스 같은 보편적인 방향 기호를 사용한다.
  - 그림 20-4에서 고객 등록의 성능은 중간(4)이지만 방향은 마이너스 부호라서 점점 상황이 나빠지고 리스크가 높아지는 추세이다.
  - 아무 부호도 없으면 리스크가 안정적이라서 특별히 좋아지거나 나빠지는 상태가 아니라는 뜻이다.
 
<img width="586" alt="스크린샷 2025-06-25 오후 4 15 05" src="https://github.com/user-attachments/assets/876a3b1a-5454-4507-9c12-387c8c7321e0" />

- 어떤 이들에겐 플러스/마이너스 부호조차 헷갈릴 수 있으니 진행 중인 방향의 리스크 등급 번호와 화살표를 병기하는 것도 좋은 방법이다.

# 20.3 리스크 스토밍
- 시스템의 모든 리스크를 아키텍트 혼자 결정할 수는 없다. 아키텍트 한 사람이 리스크 영역을 하나도 빠짐없이 살펴볼 수도 없거니와 시스템 전 부문을 완벽하게 알고 있는 아키텍트는 없다.
- 리스크 스토밍은 특정 범위 내에 있는 아키텍처 리스크를 찾아내는 협력적인 활동이다.
  - 일반적인 리스크 영역으로는 검증되지 않은 기술, 성능, 확장성, 가용성(전이적 종속성 포함), 데이터 소실, 단일 장애 지점, 보안 등이 있다.
- 리스크 스토밍 수행 과정은 개별 파트와 협력 파트가 공존한다.
  - 개별파트는 모든 참가자가 앞 절에서 설명한 리스크 매트릭스를 이용하여 각자 알아서 아키텍처 영역에 리스크를 할당한다.
  - 협력 파트는 전체 참가자가 모여 리스크 영역에 대해 공감하고 어떻게 하면 리스크를 줄일 수 있을지 논의한다.
- 개별/협력 파트 모두 아키텍처 다이어그램을 사용한다.
  - 일반적으로 전체 리스크 평가는 종합적인 아키텍처 다이어그램을 사용하고, 애플리케이션의 특정 영역에 관한 리스크 스토밍은 해당 아키텍처 다이어그램을 사용한다.
 
<img width="621" alt="스크린샷 2025-06-25 오후 4 19 45" src="https://github.com/user-attachments/assets/2fbe3a11-3e1d-402c-8052-175c78635364" />

- 그림 20-6에서는 AWS 일래스틱 로드밸런서는 웹 서버와 애플리케이션 서비스가 위치한 각 EC2 인스턴스를 처리한다.
  - 애플리케이션 서비스는 MySQL, 레디스 캐시, 몽고 DB를 호출해서 로깅한다.
  - 푸시 확장 서버도 함께 호출하는데, 이 확장서버는 다시 MySQL, 레디스 캐시, 몽고DB의 로깅 기능과 연계된다.
- 리스크 스토밍은 크게 식별, 합의, 완화 단계로 이루어진다.
- 식별 활동은 언제나 개별적이고, 합의와 완화는 모든 참가자가 한데 모여 작업하는 협력적 활동이다.

### 20.3.1 식별
- 각 참여자가 아키텍처 내부의 리스크 영역을 개인적으로 식별하는 활동이다.
  - 리스크 스토밍을 주관하는 아키텍트가 협력 파트를 진행하기 하루, 이틀 전에 전원에게 초대장을 보낸다. 이 초대장에는 아키텍처 다이어그램, 리스크 스토밍 부문, 리스크 스토밍의 협력 파트를 동봉한다.
  - 참가자는 리스크 매트릭스를 이용해 개별적으로 아키텍처를 분석하고 분류한다.
  - 참가자는 작은 색상별 포스트잇 메모지에 리스크 번호를 각각 기재한다.
- 리스크 스토밍은 보통 한 가지 특정 부분(예: 성능)만 분석하지만 사정에 따라 여러 부문을 한 번에 분석하는경우도 있다.
  - 리스크 스토밍을 할 때에는 가급적 한가지 부문으로 제한해야 된다.

### 20.3.2 합의

<img width="621" alt="스크린샷 2025-06-25 오후 5 14 27" src="https://github.com/user-attachments/assets/1bd5d5a6-2052-4566-8019-271b2567050d" />

- 리스크 스토밍에서 합의는 참가자 모두가 아키텍처 내부의 리스크에 대해 뜻을 함께 한다는 목표를 생각해보면 매우 협력적인 활동이다.
- 리스크 스토밍 세션 참가자들은 각자 리스크를 발견한 영역의 아키텍처 다이어그램에 포스트잇을 붙이기 시작한다.
- 포스트잇을 다 붙인 후 리스크 스토밍의 협력 파트가 시작된다. 리스크 스토밍의 목표는 사람들이 한 팀이 되어 리스크 영역을 분석하고 과연 그것이 리스크가 맞는지 합의를 이끌어내는 것이다.
- 3, 5번은 세 참가자 모두 리스크 레벨과 당위성에 동의했으니 논의할 필요는 없지만 1번은 의견 차이가 있고, 2 4번은 한 명의 참가자만 리스크라고 생각하기 때문에 합의 활동을 통해 논의되어야 한다.
- 1번 일래스틱 로드 밸런서는 두 참가자가 리스크 중간으로 식별한 반면 나머지 한 참가자는 높음으로 식별했다. 이런 경우 리스크 중간으로 생각한 참가자들이 높음을 매긴 세 번째 참가자에게 그 이유를 묻기 시작하여 합의에 도달한다.
- 2번 푸시 확장 서버 사례도 마찬가지로 합의에 도달해야 된다.
- 4번은 흥미롭다. 레디스 캐시를 리스크 높음으로 식별한 이유는 그 참가자가 레디스 캐시를 알지 못했기 때문이다. 즉, 검증되지 않았거나 알려지지 않은 기술은 가장 높은 리스크 등급을 매겨야 바람직하다.

# 20.3.3 완화
- 아키텍처 리스크 영역에 대해 합의한 후 마지막으로 가장 중요한 리스크 완화 활동을 해야한다. 리스크를 줄이려면 일반적으로 아키텍처의 특정 영역을 변경 또는 개선하는 작업이 필요하다.
- 합의와 마찬가지로 협력 파트인 완화 활동에서 참가자는 앞서 시별된 리스크를 줄이거나 없앨 방법을 모색해야 된다.
- 아키텍처를 변경하는 모든 작업에는 추가 비용이 들어가므로 주요 이해관계자들은 리스크를 줄이기 위해 그 만한 비용을 부담할 가치가 있는지 결정한다.
- 전체 아키텍처는 물론, 아키텍트와 비즈니스 이해관계자들 간의 협상에도 리스크 스토밍은 상당한 영향을 미칠 수 있다.

# 20.4 애자일 스토리 리스크 분석
- 리스크 스토밍은 아키텍처는 물론 다른 소프트웨어 개발 분야에도 응용할 수 있다. 가령, 스토리 그루밍을 하면서 이번 애자일 이터레이션 유저 스토리를 완료하는데 전체적으로 어떤 리스크가 있는지 알아보는 용도로 리스크 스토밍을 활용할 수 있다.

# 20.5 리스크 스토밍 예시
- 환자들의 다양한 건강 상태에 대해 간호사가 조언을 해주는 콜 센터 시스템이 있다.
  - 질문을 받으면 간호사나 환자에게 의료 문제를 안내하는 서드파티 진단 엔진을 사용한다.
  - 환자는 콜 센터에 전화를 걸어 간호사와 통화하거나 간호사 없이 직접 진단 엔진에 액세스하는 셀프 서비스 웹사이트를 이용한다.
  - 전국적으로 250명의 간호사와 수십만 명에 달하는 셀프 서비스 환자를 동시에 지원할 수 있어야 한다.
  - 간호사는 환자의 의무 기록을 열람할 수 있지만, 환자는 자신의 의무 기록을 볼 수 없다.
  - 의무 기록에 관한 미국 의료 정보 보호법Health Insurance Portability and Accountability Act(HIPAA)를 준수해야 한다. 즉, 간호사 이외의 그 누구도 의무 기록을 열람할 수 없다.
  - 전염병과 독감이 유행하는 시즌에 데이터 요청이 급증해도 시스템이 이를 감당해야 한다.
  - 간호사 프로필(예: 외국어 가능)에 따라 통화가 연결되어야 한다.
  - 서드파티 진단 엔진은 초당 약 500개의 요청을 처리할 수 있어야 한다.
 
<img width="594" alt="스크린샷 2025-06-25 오후 5 29 09" src="https://github.com/user-attachments/assets/25f004fe-e28d-4b92-a5f1-8a09c80f98a2" />

### 20.5.1 가용성

<img width="594" alt="스크린샷 2025-06-25 오후 5 32 53" src="https://github.com/user-attachments/assets/f7483421-96e8-497f-be34-099a09912293" />

- 리스크 스토밍에 참가한 사람들은 식별, 협력 활동의 결과로 리스크 매트릭스를 만들어 다음과 같이 리스크 영역을 제시했다.
- 모든 참가자는 데이터베이스가 다운되면 간호사가 사례 기록을 수기로 작성할 수 있지만 데이터베이스를 사용할 수 없으니 통화 라우터는 작동하지 않으리란 점에 동의했다.
  - 완화하려면 하나의 물리적인 데이터베이스를 간호사 프로필 정보가 저장된 데이터베이스 클러스터, 단일 인스턴스 형태의 사례 기록용 데이터베이스 이렇게 2개의 데이터베이스로 분리하는게 낫다는 결론을 내렸다.
- 외부 시스템은 마음대로 제어할 수 없기 때문에 가용성 관리가 훨씬 어렵다. 이런 종류의 가용성 리스크를 완화하는 한 가지 방법은 시스템별로 SLA나 SLO가 명시된 문서를 확인해야 된다.

<img width="594" alt="스크린샷 2025-06-25 오후 5 35 38" src="https://github.com/user-attachments/assets/a42d46fa-3fc3-4a94-96c2-fa4eaa1d98f4" />

- 리스크 스토밍 세션 이후에 변경된 아키텍처 다이어그램이다. DB를 둘로 나누었고, SLA도 그림에 명시했다.

### 20.5.2 탄력성

<img width="594" alt="스크린샷 2025-06-25 오후 5 40 45" src="https://github.com/user-attachments/assets/9d556b78-75ed-48b0-ae10-1fc6d4281ac3" />

- 간호사는 250명에 불과하지만 셀프 서비스 파트도 진단 엔진과 간호사 정보를 액세스할 수 있으므로 진단 인터페이스에 상당한 요청이 몰릴 수 있다.
- 모든 참가자는 만장일치로 진단 엔진 인터페이스를 리스크 높음으로 식별했다.
- API 게이트웨이와 진단 엔진 인터페이스 간의 배압 지점에 비동기 큐를 두고 진단 엔진 호출의 완충지대를 활용하는 방법도 있지만 진단 엔진의 응답을 너무 오래기다리거나 타임아웃이 발생할 가능성이 있으므로 좋은 방법이 아니다.
- 참가자들은 배압 지점을 제공하는 큐 기술 외에도 발병에 관한 특정 진단 질문을 캐시함으로써 진단 엔진 인터페이스에 도달하는 호출을 줄일 수 있다고 판단했다.

### 20.5.3 보안
- HIPAA 규제 요구사항 때문에 의무 기록 열람은 간호사만 열람이 가능하도록 안전하게 관리해야 한다.
- 리스크 스토밍 결과 참가자는 전원 진단 시스템 API 게이트웨이를 리스크 높음으로 식별했다.
  - 관리 직원이나 셀프 서비스 환자가 의무 기록을 열람할 때의 영향도(3)와 그럴 가능성이 중간(2)임을 감안한 결과이다.
- 참가자들은 유저 유형별로 API 게이트웨이를 사용하면 관리자용 웹 유저 인터페이스 또는 셀프 서비스용 웹 유저 인터페이스의 호출이 의무 기록 시스템까지 도달하지 못하게 막을 수 있다고 입을 모았다.

<img width="594" alt="스크린샷 2025-06-25 오후 5 43 56" src="https://github.com/user-attachments/assets/2e6cb655-9454-4110-bee9-85e5141fe822" />

- 시스템 성공을 좌지우지할 정도로 중대함에도 불구하고 잘 안 보이는 중요한 리스크 영역을 다른 아키텍트, 개발자, 주요 이해관계자들과 협력하여 식별한 것이다.
- 리스크 스토밍은 1회성 프로세스가 아니라, 프로덕션에서 발생하기 전에 리스크 영역을 포착하고 미리 그 해결 방법을 찾는, 시스템이 살아 숨쉬는 내내 계속 반복하는 과정이다.
- 
