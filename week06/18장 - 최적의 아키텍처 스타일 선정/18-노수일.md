# 18. 최적의 아키텍처 스타일 선정
- 최적의 아키텍처 스타일은?
    - 상황에 따라 다름
    - 조직 내부의 수많은 팩터들과 어떤 소프트웨어를 구축하는지에 따라 맥락이 달라짐
    - 아키텍처 특성, 도메인 고려 사항, 전략적 목표, 그 밖의 다양한 것들의 트레이드오프를 고려하고 분석한 마지막 결과로 선택
## 18.1 아키텍처 '유행'은 계속 변한다
#### 과거를 돌아보다
- 새로운 아키텍처 설계는 과거 아키텍처 스타일에서 발견된 결함이 반영된 경우가 많음
#### 생태계의 변화
- 끊임없는 변화는 소프트웨어 개발 생태계의 바람직한 특성
- 수년 전만 해도 쿠버네티스가 무엇인지 거의 아무도 몰랐지만 현재는 컨퍼런스가 여럿 개최
- 수년 후에는 다른 도구에 의해 대체될 수 있음
#### 새로운 기능
- 새로운 기능이 출현하면 아키텍처는 단순히 어떤 도구를 다른 도구로 대체하는 정도가 아닌, 완전히 새로운 패러다임으로 전환될 수 있음
- 도커와 같은 컨테이너
- 새로운 도구는 물론 새로운 패러다임 역시 예의주시해야 함
- 작은 변화라도 아키텍트의 모굪와 정확히 부합하는 변경일 수 있음
#### 가속
- 변화의 속도도 빨라지고 있음
#### 도메인 변경
- 비즈니스가 계속 진화하고 타 회사와 합병되면서 도메인 역시 도통 가만히 있는 법이 없음
#### 기술 변화
- 기술이 진화할수록 조직은 최소한 그 변화의 흐름의 일부라도 따라잡으려고 함
#### 외부 팩터
- 소프트웨어 개발과 연관된 많은 주변 요인들이 조직의 변화를 가져오는 경우도 있음
- 비용
## 18.2 결정 기준
- 아키텍트는 아키텍처 스타일을 선택할 때 설계 구조의 원인이 될 만한 모든 요소를 종합적으로 고려해야 함
- 주어진 도메인, 그리고 시스템을 성공적으로 구축하는 데 필요한 다른 모든 구조적 요소들을 설계함
#### 도메인
- 도메인에서 중요한 여러 가지 양상, 특히 어느 부분이 운영 아키텍처 특성에 영향을 미치는지 파악해야 함
- 해당 분야의 전문가일 필요는 없지만, 자신이 설계하는 도메인에서 중요한 파트에 대해서 최소한의 지식은 갖고 있어야 함
#### 구조에 영향을 미치는 아키텍처 특성
- 도메인과 다른 외부 요소를 지원하는 데 필요한 아키텍처 특성을 정확하게 밝혀내야 함
#### 데이터 아키텍처
- 아키텍트와 DBA는 데이터베이스, 스키마 등 데이터에 관한 문제를 의논해야 함
- 데이터 아키텍처는 전문 분야
- 데이터 설계가 아키텍처 설계에 미치는 영향도를 미리 파악해야 함
#### 조직 문제
- 갖가지 외부 팩터도 설계에 영향을 줌
    - 벤더사 이용료
    - 회사의 인수 합병
#### 프로세스, 팀, 운영 문제에 관한 지식
- 소프트웨거 개발 프로세스, 운영팀과의 소통, QA 프로세스 등 프로젝트와 관련된 다양한 팩터들도 아키텍처 설계에 영향을 끼침
#### 도메인/아키텍처 동형성
- 아키텍처의 토폴로지와 잘 맞는 문제 영역이 있음
- 반대로 문제 영역과 아키텍처 스타일이 불협화음이 나는 경우도 있음
#### 모놀리스냐 분산이냐
- 아키텍처 퀀텀 개념을 이용
- 단일 아키텍처 특성만으로도 설계에 부족함이 없는지
- 시스템 파트별로 상이한 아키텍처 특성이 필요한지 판단
#### 데이터를 어디에 둘 것인가?
- 모놀리식 아키텍처는 하나 또는 솟의 관계형 데이터베이스를 전제
- 분산 아키텍처에서는 어느 서비스가 어떤 데이터를 저장할지 결정해야 함
- 워크플로를 구축하기 전에 전체 아키텍처의 데이터 흐름에 대해 충분히 숙고해야 함
- 구조와 행위를 모두 고려하여 최적의 조합을 찾아내기 위해 설계를 무한반복하는 것도 두려워해서는 안됨
#### 서비스간 통신은 동기, 비동기 중 어떤 스타일로 할 것인가?
- 데이터를 어떻게 분할할지 정한 다음에 서비스간 통신 방식을 동기로 할지, 비동기로 할지 결정
- 동기 통신은 간편하지만 확장성, 안정성, 그 밖의 다른 아키텍처 특성에 부정적인 여향
- 비동기 통신은 성능, 확장성 측면에서 우월하나, 데이터 동기화, 데드락, 경합 조건, 디버깅 등 골칫거리가 많음
- 설계, 구현, 디버깅 문제가 적은 동기 통신을 기본으로 하되, 필요한 경우에 비동기 통신을 함께 사용하는 것이 좋음
## 18.3 모놀리스 사례 연구: 실리콘 샌드위치
- 실리콘 샌드위치 카타의 아키텍처 특성
    - 단일 퀀텀으로 구현해도 충분
    - 적은 예산으로도 구축 가능한 단순 애플리케이션
- 도메인 분할된 컴포넌트와 기술 분할된 컴포넌트 두 가지 상이한 컴포넌트 설계 비교, 트레이드 오프 조사
### 18.3.1 모듈러 모놀리스
- 단일 퀀텀으로 배포된 단일 데이터베이스 기반의 도메인 중심 시스템
- 시간과 리소스가 넉넉하다면 아키텍트는 도메인 컴포넌트 단위로 테이블과 기타 데이터베이스 자산을 분리
    - 나중에 요구사항이 발생하면 분산 아키텍처로 쉽게 마이그레이션 할 수 있도록 설계
- 아키텍처 스타일 자체는 커스터마이징 할 수 없음
    - 아키텍트는 원하는 기능을 도메인 설계의 일부로 넣어야 함
    - 개발자가 개별적으로 커스터마이징한 결과물을 업로드 할 수 있도록 오버라이드 엔드포인트 설계
    - 각 도메인 컴포넌트가 커스터마이징 가능한 각각의 특성을 오버라이드 컴포넌트를 통해 참조할 수 있게 설계해야 완벽한 피트니스 함수가 만들어짐
### 18.3.2 마이크로커널
- 실리콘 샌드위치에서 식별된 특성 중 하나가 맞춤성
- 도메인/아키텍처 동형성을 검토 후, 마이크로커널 형태로 구현 가능
- 도메인과 데이터를 신중하게 동기화하면 향후 분산 아키텍처로 코어를 마이그레이션할 수 있음
- 커스터마이징은 각각 하나의 플러그인, 단일 플러그인 세트 내부의 공통 플러그인, 일련의 로컬 플러그인 형태로 나타남
    - 어느 플러그인도 다른 것들과 커플링될 일이 없어 자신의 데이터 유지 가능
- 프런트를 위한 백엔드(BFF) 패턴을 응용해서 API 레이어를 마이크로커널 어댑터로 사용하는 독특한 설계방법도 있음
    - 일반적인 정보는 백엔드가 제공하고 BFF 어댑터는 이 정보를 프런트엔드 장치에 적합한 포멧으로 바꿈
## 18.4 분산 아키텍처 사례 연구: GGG
- 8.7절의 컴포넌트 분석 결과에 따르면, 아키텍처의 여러 부분마다 상이한 아키텍처 특성을 필요로 함
    - 가용성, 확장성 같은 특성이 입찰자와 경매인 등 역할마다 다름
- 규모, 탄력성, 성능, 그 밖의 까다로운 운영 아키텍처 특성이 명시되어 있음
    - 아키텍처 내부의 세부적은 수준까지 고도의 커스터마이징이 가능한 패턴을 선택해야 함
    - 마이크로서비스는 다양한 운영 아키텍처 특성을 보다 잘 지원함
- 마이크로서비스에서 요구사항에 명시된 성능을 달성하기는 어려움
- GGG의 세 가지 고유한 유저 인터페이스
    - 입찰자
        - 온라인 경매에 참가한 수많은 입찰자
    - 경매인
        - 경매 당 한 사람
    - 스트리머
        - 입찰자에게 동영상 및 입찰 스트리밍을 담당하는 서비스
        - 읽기 전용 스트림이므로 업데이트가 필요한 경우 최적화는 사용할 수 없음
- GGG 아키텍처 설계에 등장하는 서비스들
    - BidCapture
        - 온라인 입찰자의 입찰을 캡처해서 BidTracker로 비동기 전송
        - 온라인 입찰의 관문 역할을 할 뿐 퍼시스턴스 로직은 없는 서비스
    - BidStreamer
        - 온라인 입찰자에게 입찰 정보를 고성능 읽기 전용 스트림으로 스트리밍함
    - BidTracker
        - AuctioneerCapture, BidCapture 양쪽에서 입찰을 추적
        - 서로 다른 두 정보 스트림을 하나로 합하여 가능한 실시간에 가깝게 입찰을 정렬
        - 이 서비스의 두 인바운드 커넥션은 모두 비동기, 개발자는 메시지 큐를 버퍼로 사용해 완전히 다른 속도로 메시지 흐름 처리
    - AuctioneerCapture
        - 경매인을 위해 입찰을 캡처
        - BidCapture와 AuctioneerCapture로 분리됨
    - AuctionSession
        - 각 경매의 워크플로를 관리
    - Payment
        - AuctionSession이 경과하여 경매가 완료된 후 결제 정보를 처리하는 서드파티 결제 서비스
    - VideoCapture
        - 라이브 경매의 비디오 스트림을 캡처함
    - Video Streamer
        - 경매 동영상을 온라인 입찰자에게 스트리밍함
- 동기 통신 스타일과 비동기 통신 스타일을 주의 깊게 식별함
    - 비동기 통신을 선택한 것은 주로 서비스마다 상이한 운영 아키텍처 특성을 감안
- 최종 분석 결과, 이 설계는 5개의 퀀텀으로 마무리
