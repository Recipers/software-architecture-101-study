# 6. 아키텍처 특성의 측정 및 거버넌스
- 아키텍트는 소프트웨어 프로젝트의 거의 전 부문에 걸쳐 다양한 아키텍처 특성을 다루는 사람
- 성능, 탄력성, 확장성 등의 운영 특성들이 모듈성, 배포성 같은 구조적인 관심사와 한데 뒤섞임
## 6.1 아키텍처 특성 측정
- 아키텍처 특성 정의할 때 생기는 문제
#### 물리학이 아니다
- 아키텍처 특성은 대부분 의미가 모호함
- 동일한 용어도 바라보는 시각이 제각각이고, 상황에 따라 좌지우지되거나 우발적으로 의미가 정해짐
#### 정의가 너무 다양하다
#### 너무 복잡하다
- 바람직한 아키텍처 특성은 대부분 더 작은 다른 여러 특성들로 구성됨
### 6.1.1 운영적 측명
- 아키텍처 특성은 정확하게 측정할 수 있는 것도 많지만, 팀 목표에 따라 해석이 갈릴 때가 많음
- 수준 높은 팀은 달성하기 어려운 성능 수치를 정하는 대신, 통계 분석 결과로 얻은 나름대로의 정의에 기반함
- 도구가 발전하고 이해도가 높아지면서 팀이 측정할 수 있는 아키텍처 특성은 빠르게 진화하고 있음
    - ex : 최초 콘텐츠 렌더링, 최초 CPU 유후
### 6.1.2 구조적 측정
- 성능처럼 목표치가 확실하지 않은 메트릭도 있음
- 잘 정의된 모듈성같은 내부 구조에 관한 특성도 그러함
    - 코드 품질에 대한 종합적인 메트릭은 없지만, 다른 메트릭과 공통 도구를 이용할 수 있음
    - ex : 코드의 복잡도는 순환 복잡도라는 메트릭을 통해 명쾌하게 측정 가능
### 6.1.3 프로세스 측정
- 소프트웨어 개발 프로세스와 교차하는 아키텍처 특성
    - 민첨성은 시험성, 배포성 등의 특성으로 나눌 수 있는 복합적인 아키텍처 특성
    - 시험성
        - 거의 모든 플랫폼에서 테스트의 완전성을 평가하는 코드 커버리지 도구
        - 객관적으로 측정할 수 있는 특성
    - 배포성
        - 실패 대비 배포 성공률(%)
        - 배포 소요 시간
        - 배포 시 발생한 이슈/버그 등 다양한 메트릭으로 측정됨
    - 민첩성
        - 관련된 부분은 소프트웨어 개발 프로세스와 연관이 있음
        - 이 프로세스는 아키텍처 구조에도 영향을 미칠 수 있음
        - ex : 배포 용이성과 시험성이 최우선 항목이라면, 아키텍처 수준에서 모듈성, 격리성을 높이는데 주력할 것
## 6.2 거버넌스와 피트니스 함수
- 아키텍트가 아키텍처 특성을 확정 후 우선순위를 정하면 개발자들이 우선순위를 잘 지킬거라 확신하는 방법
    - 거버넌스 메커니즘을 강구해야 함
### 6.2.1 아키텍처 특성 관리
- 거버넌스는 아키텍트가 영향력을 행사하려는 모든 소프트웨어 개발 프로세스를 포괄함
    - ex : 소프트웨어 품질 보장 업무
- 요즘에는 좋은 솔루션들이 많이 등장함
- 소프트웨어 자동화
    - 지속적 통합
- 운영 자동화
    - 데브옵스 체계에 이름
- 아키텍처 거버넌스를 통해 계속 발전되고 있음
### 6.2.2 피트니스 함수
- Building Evolutionary Architectures에 '진화적'은 생물학보다 진화적 컴퓨팅에서 더 많이 나오는 단어
- 결과가 목표에 얼마나 근접했는지를 나타내는 목표 함수가 피트니스 함수
#### 아키텍처 피트니스 함수
- 아키텍처 특성의 객관적인 무결성을 평가하는 모든 메커니즘
- 수많은 기존 도구들을 바라보는 새로운 시간
- 아키텍처 특성을 검증하는 기법은 다양함
- 피트니스 함수는 사용하는 방법에 따라 메트릭, 모니터, 단위 테스트 라이브러리, 카오스 엔지니어링 등 기존의 많은 메커니즘과 중첩되는 부분이 있음
#### 순환 의존성
- 모듈성은 대부분의 아키텍트가 관심을 기울이는 암묵적인 아키텍처 특성
- 모듈성이 제대로 유지되지 못하면 코드베이스 구조에 해를 끼치므로 우선 순위를 높게 두어 관리할 수 밖에 ㅇ벗음
- 아키텍트가 좋은 의도를 갖고 있더라도 많은 플랫폼에서 그에 반하는 어쩔 수 없는 일들이 벌어짐
    - 자바나 닷넷 IDE에서 임포트하지 않은 클래스를 자동으로 임포트하게 도와줌
    - 개발자가 자동 임포트의 관성에 빠지게 되는데, 별 생각없이 컴포넌트를 마구 임포트 하는건 정말 좋지 않음
    - 매우 유해한 안티패턴
- 피트니스 함수로 순환 참조 여부를 발견할 수 있음
    - JDepend 라는 메트릭 도구로 패키지 간 의존성 체크
    - 순환 참조가 하나라도 존재하면 테스트 실패
#### '메인 시퀀스로부터의 거리' 피트니스 함수
- JDepend로 수용 가능한 임계치를 설정하고 클래스가 이 범위를 벗어나면 테스트를 실패하도록 처리
- 피트니스 함수 도구는 점점 더 정교해지고, 목적에 따라 특화된 것들도 있음
    - JUnit의 영향을 받아 탄생한 ArchUnit
        - Junit 체계의 일부를 활용한 자바 테스트 프레임워크
        - 단위 테스트로 코드화한 사전 정의된 거버넌스 규칙을 풍성하게 제공
        - 모듈성에 특화된 테스트를 작성할 수 있음
    - 닷넷 진영의 NetArchTest
    - 넷플릭스의 카오스 멍키, 시미안 아미
        - 적합성, 보안, 문지기 멍키는 피트니스 함수의 접근 방식을 잘 나타냄
        - 적합성 멍키를 이용하면 넷플릭스 아키텍트가 프로덕션에서 멍키로 강제한 규칙들을 정의할 수 있음
            - 모든 서비스가 모든 REST 동사에 유효한 응답을 해야 한다면 적합성 멍키에 해당 체크 로직 구축
        - 보안 멍키는 열려 있으면 안 되는 포트가 있거나 각종 설정 오류 등 서비스에 잘 안알려진 보안 취약점 체크
        - 문지기 멍키는 더 이상 다른 서비스에서 트래픽이 들어오지 않는 서비스 인스턴스를 찾음 (고아 서비스 찾고 제거)
- 항공기 조종사, 외과 의사 등 전문직 종사자들이 체크 리스트를 사용하는 이유
    - 세부적인 일을 반복하면 간혹 빠뜨리고 지나치는 것들이 있기 때문
    - 간결한 체크리스트는 효과적으로 기억을 되살려주는 역할을 함
    - 피트니스 함수가 그 역할을 함
    - 피트니스 함수는 무거운 거버넌스 메커니즘보다 아키텍트가 중요한 아키텍처 원칙을 표현하고 자동으로 검증할 수 있는 메커니즘을 제공
