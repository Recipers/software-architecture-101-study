- 소프트웨어 아키텍처 세계에서는 전통적으로 아키텍처 특성의 범위를 시스템 레벨에 두는 것을 당연시했다. 확장성을 논할 때에는 일반적으로 전체 시스템의 확장성을 가리키는 것이였다. 거의 모든 시스템이 모놀리식이었으니 안전한 전제였다. 현대에 들어서 현대적인 공학 기술의 등장과 마이크로서비스 등의 아키텍처 스타일이 가능하면서 아키텍처 특성의 범위는 상당히 좁아졌다.
- 어떤 아키텍처 스타일의 구조적인 진화 가능성을 측정할 기술이 필요해졌다. 
- 아키텍트는 운영 아키텍처 특성을 따져보고 아키텍처 특성에 영향을 미치는 코드베이스 외부의 컴포넌트를 잘 살펴봐야 한다. 그래서 "Building Evolutionary Architectures"의 저자들은 아키텍처 퀀텀이라는 용어를 정의했다. 퀀텀의 의미를 이해하려면 먼저 커네이선스라는 핵심 메트릭을 잘 알아두어야 한다
# 7.1 커플링과 커네이선스
- 구심/원심 커플링 같은 코드 레벨의 커플링 메트릭은 아키텍처 분석용으로는 너무 세분도가 높은 편이다.
- **커네이선스**
	- 정의: 두 컴포넌트 중 한쪽이 변경될 경우 다른 쪽도 변경해야 전체 시스템의 정합성이 맞는다면 이들은 커네이선스를 갖고 있는 것이다.
	- 커네이선스는 정적 코드 분석으로 발견할 수 있는 정적 커네이선스와 런타이므 동작에 관련된 동적 커네이선스로 분류할 수 있다. 아키텍처 퀀텀을 정의하려면 컴포넌트가 어떻게 서로 연결되어 있는지 측정할 방법이 필요한데, 이것이 바로 커네이선스라는 개념이다.
	- 마이크로서비스 아키텍처의 두 서비스가 address라는 동일한 클래스를 공유한다면 두 서비스는 서로 정적인 커네이선스를 가진다.
	- 동적 커네이선스는 동기, 비동기 두 종류가 있다. 분산 서비스끼리 동기 호출을 하면 호출부는 피호출부의 응답을 기다려야 하는 반면, EDA의 비동기 호출은 운영 아키텍처에서 개별적으로 작동시킬 수 있다.
# 7.2 아키텍처 퀀텀과 세분도
- 소프트웨어를 서로 엮는 것은 컴포넌트 레벨의 커플링만이 아니다. 많은 비즈니스 개념이 의미상 여러 시스템 파트를 한대 엮어 기능적으로 응집되어 있다.
- 퀀텀(양자)은 상호작용을 하는 모든 물리 입자 가운데 가장 작은 양으로 이와 같은 개념에서 아키텍처 퀀텀을 도입했다.
- **아키텍처 퀀텀**
	- 정의: 높은 기능 응집도와 동기적 커네이선스를 가진, 독립적으로 배포가능한 아티팩트
	- 독립적으로 배포 가능
		- 아키텍처 퀀텀은 아키텍처의 다른 파트와 독립적으로 작동되는 모든 필수 컴포넌트를 포함한다. 예를 들어 데이터베이스를 사용하는 애플리케이션은 데이터베이스 없이는 작동되지 않으므로 데이터베이스는 퀀텀의 일부이다.
		- 단일 데이터베이스를 사용하여 배포된 레거시 시스템의 아키텍처 퀀텀은 1이지만, 마이크로서비스 아키텍처는 서비스마다 데이터베이스가 따로 있으니 퀀텀이 여러 개이다.
	- 높은 기능 응집도
		- 응집도는 컴포넌트 설계에 따라 구현된 코드가 얼마나 목적에 맞게 통합되어 있는지를 나타낸다.
		- 예를 들어 Customer 컴포넌트는 고객 엔티티와 관련된 모든 프로퍼티와 메서드를 갖고 있으므로 응집도가 높지만 Utility 컴포넌트는 응집도가 낮다.
		- 기능 응집도가 높다는 건 아키텍처 퀀텀이 목적에 맞게 뭔가를 하고 있다는 뜻이다. 단일 데이터베이스를 사용하는 모놀리식 애플리케이션에서는 이런 구분이 의미가 없지만 마이크로서비스 아키텍처는 보통 개발자가 각 서비스를 하나의 워크플로에 맞게 설계하므로 기능 응집도가 높게 나타난다.
	- 동기적 커네이선스
		- 동기적 커네이선스는 아키텍처 퀀텀을 형성하는 애플리케이션 컨텍스트 내부 또는 분산 서비스 간의 동기 호출을 의미한다.
		- 예를 들면 마이크로서비스 아키텍처에서 어떤 서비스가 다른 서비스를 동기 호출할 때, 운영 아키텍처 특성 측면에서 두 서비스는 두드러진 차이를 나타낼 수 없다. 어느 한 쪽이 확장성이 훨씬 좋다면 타임아웃과 여러 신뢰성 문제를 나타낼 것이다. 따라서 동기 호출은 호출 길이에 대해 동적 커네이선스를 만들어낸다. 호출부와 피호출부 양쪽의 운영 아키텍처 특성이 동일해야 한다.
		- Payment 서비스, Auction 서비스가 있고 Auction -> Payment 서비스의 호출 의존성이 있다고 치자. Payment는 매 500밀리초마다 하나의 결제 정보만 처리할 수 있을 때 만약 엄청나게 많은 경매가 일시에 종료된다면 첫 번째 호출은 통과하고 나머지 호출은 모조리 타임아웃이 발생할 것이다.
			- Payment, Auction 간에 비동기 통신 링크를 만들고 메시지 큐가 일시적인 버퍼 역할을 수행하도록 설계하면 비동기적 커네이선스 덕분에 아키텍처가 한층 더 유연해진다.
	- 현대 시스템에서 아키텍트는 시스템 레벨보다는 퀀텀 레벨의 아키텍처 특성을 정의한다. 중요한 운영 관심사에 대해 범위를 좁혀보면 중요한 아키텍처 문제를 조기에 발견하여 하이브리드 아키텍처를 설계할 수 있다.
### 7.2.1 사례 연구: GGG
```
설명
이 경매 회사는 온라인 경매 시장을 전국적으로 확장하려고 한다.
고객이 참여할 경매를 선택하고 기다렸다가 경매가 시작되면 마치 처음부터 경매인과 같은 공간에 있었던 것처럼 입찰을 시작한다.

유저
경매 당 참여자는 수백 명, 어쩌면 수천 명까지 늘어날 수 있고 많은 동시 경매가 이루어질 것이다.

요구사항
경매는 가급적 실시간 처리가 가능해야 한다.
입찰자는 낙찰 시 자동 결제할 신용카드를 등록한다.
입찰자는 평판 지수reputation index로 추적되어야 한다.
입찰자는 라이브 동영상 스트림을 시청하면서 발생하는 모든 입찰을 볼 수 있어야 한다.
온라인/라이브 입찰 모두 입찰이 일어난 순서대로 접수되어야 한다.

부가 콘텍스트
이 경매 회사는 공격적으로 규모가 상대적으로 작은 경쟁사를 인수 합병하여 사세를 키우고 있다.
예산 제한은 따로 없다. 전략적으로 그렇게 결정됐다.
이 회사는 위조 혐의로 고발된 소송에서 이제 막 벗어났다.
```
1. '전국적인 확장', '경매 당 참여자는 수백 명, 어쩌면 수천 명 까지 늘어날 수 있고 많은 동시 경매가 이루어질 것이다', '경매는 가급적 실시간 처리가 가능해야 한다'
	1. 유저 수를 지원하는 확장성과 폭주하는 트래픽을 지원하는 탄력성이 필요하다. 확장성은 요구사항 정의서에 명시되어 있지만 탄력성은 문제 도메인에 따라 암묵적인 특성으로 나타난다. 아키텍트가 암묵적인 아키텍처 특성을 집어내려면 도메인 지식이 매우 중요하다.
2. '입찰자는 낙찰 시 자동 결제할 신용카드를 등록한다', '이 회사는 위조 혐의올 고발된 소송에서 이제 막 벗어났다'
	1. 이 두 요구사항은 보안이라는 아키텍처 특성을 분명하게 가리킨다. 보안은 거의 모든 애플리케이션에 존재하는 암묵적 아키텍처 특성이다. 뭔가 특별한 것을 설계하여 보안 요건을 수용해야 할까? 아니면 일반적인 설계와 코드 품질 정도로 충분할까? 특별한 구조를 만들지 않아도 신용 카드를 안전하게 처리할 수 있는 기법은 얼마든지 있다. 그러나 두 번째 문장에서 추가로 확인할 부분은 없는지 살펴봐야 한다.
3. '입찰자는 평판 지수로 추적되어야 한다'
	1. 뭔가를 '추적'한다는 것은 감사성, 로그성과 같은 아키텍처 특성을 의미한다. 아키텍처 특성을 도출하는 분석이 애플리케이션을 설계/구현하는 모든 노력에서 아주 작은 비중을 차지하는 것을 기억해야 한다.
	2. 도메인이냐, 아키텍처 특성이냐를 결정할 때 "구현을 하려면 도메인 지식이 필요한가, 아니면 추상적인 아키텍처 특성인가?"라는 질문을 던질 수 있다. '평판 지수'는 일반적인 아키텍처 특성에 속하는 표준 정의가 아니다. 아키텍트는 탄력성을 논할 때 아키텍처 특성을 순수하게 추상화하여 이야기할 수 있다. 뱅킹 앱, 카탈로그 사이트, 비디오 스트리밍 서비스 등 애플리케이션의 종류는 중요하지 않다. 아키텍트는 이미 요구사항이 도메인에 포함되어 있는지, 특별한 구조가 필요한지 잘 판단해야 한다.
4. '이 경매 회사는 공격적으로 규모가 상대적으로 작은 경쟁사를 인수 합병하여 사세를 키우고 있다'
	1. 이 요구사항은 애플리케이션 설계에 직접적인 영향을 주지 않지만 몇 가지 방안의 트레이드오프를 결정할 때 팩터가 될 수 있다. 예를 들어 연계 아키텍처에서 어떤 통신 프로토콜을 사용할지 고민할 때 새로 합병된 회사와의 연계에 별 문제가 없을 경우 문제에 고도로 특화된 프로토콜을 자유롭게 선정할 수 있다. 상호운용성처럼 추가적인 트레이드오프를 수용하기 위해 덜 완벽한 프로토콜을 선택할 수도 있다.
5. '입찰자는 라이브 동영상 스트림을 시청하면서 발생하는 모든 입찰을 볼 수 있어야 한다', '온라인/라이브 입찰 모두 입찰이 일어난 순서대로 접수되어야 한다'
	1. 이 요구사항은 애플리케이션 구조에도 분명히 영향을 미치고 아키텍처 특성을 시스템의 전체적인 평가로 취급하는 것이 무익함을 잘 보여주는 난제를 나타낸다.
	2. 아키텍처 전반에 걸쳐 가용성은 균일해야 될까? 한 입찰자의 가용성이 수백 명의 입찰자 중 한사람에 대한 가용성보다 더 중요할까? 아키텍트는 양쪽 가용성을 다 정확히 가늠해보고 싶지만 경매인이 사이트에 접속할 수 없다면 어느 누구도 온라인 입찰이 불가능하다는 사실은 명백하다. 신뢰성은 총 가동 시간, 데이터 무결성, 그 밖에 애플리케이션이 얼마나 믿을 만한지 평가하는 갖가지 운영 요소를 의미하므로 보통 가용성과 결부되어 있다. 예를 들면 경매 사이트는 경합 조건 등 여러 문제를 제거하고 메시지 순서를 정확히 보장해야 한다.

- 마지막 요구사항을 보면 시스템 레벨보다 더 세분화된 아키텍처 범위의 필요성이 돋보인다. 아키텍처 퀀텀을 이용해서 아키텍처 퀀텀 레벨에서의 아키텍처 특성의 범위를 지정한다. 가령 각 파트마다 다른 특성이 필요하다는 것을 알 수 있다. 입찰 스트리밍, 온라인 입찰자, 경매인 이 세 파트는 분명히 아키텍처 특성이 다르다. 아키텍처 퀀텀을 배포, 커플링, 데이터를 둘 장소, 아키텍처 내부 통신 스타일을 생각하는 수단으로 활용한다.
- 발견한 퀀텀과 아키텍처 특성
	- 입찰자 피드백: 입찰 스트림과 입찰 동영상 스트림을 포함한다
		- 가용성
		- 확장성
		- 성능
	- 경매인: 라이브 경매인
		- 가용성
		- 신뢰성
		- 확장성
		- 탄력성
		- 성능
		- 보안
	- 입찰자: 온라인 입찰자와 입찰
		- 신뢰성
		- 가용성
		- 확장성
		- 탄력성
