# 7 아키텍처 특성 범위
- 전통적으로 아키텍처 특성의 범위를 시스템 레벨에 두는 것을 당연시 했음
- 현대적인 공학 기술의 등장과 마이크로서비스 등의 아키텍처 스타일이 가능하면서 아키텍처 특성의 범위는 상당이 좁혀졌음
- 기존에 당연하게 여겼던 공식도 서서히 퇴물로 전락하고 있음
- 아키텍처 스타일의 구조적인 진화 가능성을 측정할 기술이 필요했음
    - 기존의 측정 기술로는 상세한 수준까지 측정 불가능
    - 6.1.2절에서 코트 레벨의 다양한 메트릭을 소개했음
        - 코드에 관한 저수준의 세부만 밝힘
        - 아키텍처 특성에 영향을 미치는, 코드베이스 외부의 의존성을 지닌 컴포넌트는 평가할 수 없었음
- 아키텍트는 아키텍처 특성에 영향을 미치는 코드베이스 외부의 컴포넌트를 잘 살펴봐야 함
    - 아키텍처 퀀텀이라는 용어를 정의
    - 아키텍처 퀀텀의 의미를 이해하려면 먼저 커네이선스 핵심 메트릭을 잘 알아두어야 함
## 7.1 커플링과 커네이선스
- 구심/원심 커플링 같은 코드 레벨의 커플링 메트릭은 아키텍처 분석용으로는 너무 세분도가 높음
#### 커네이선스
- 두 컴포넌트 중 한쪽이 변경될 경우 다른 쪽도 변경해야 전체 시스템의 정합성이 맞는다면 이들은 커네이선스를 갖고 있는 것
- 커네이선스
    - 정적 코드 분석으로 발견할 수 있는 정적 커네이선스
    - 런타임 동작에 관한 동적 커네이선스
- 아키텍처 퀀텀을 정의하려면 컴포넌트가 어떻게 서로 연결되어 있는지 측정할 방법이 필요한데, 이게 커네이선스라는 개념
    - 마이크로 서비스 아키텍처의 두 서비스가 address라는 동일한 클래스를 공유한다면 두 서비스는 서로 정적인 커네이선스를 가지는 것
    - address 변경 시, 두 서비스 모두 변경
- 동적 커네이선스는 동기, 비동기 두 종류가 있음
    - 분산 서비스끼리 동기 호출을 하면 호출부는 피호출부의 응답을 기다려야 함
    - 비동기 호출은 파이어 앤드 포겟 방식이므로 개별적으로 작동시킬 수 있음
## 7.2 아키텍처 퀀텀과 세분도
- 소프트웨어를 서로 엮는 것은 컴포넌트 레벨의 커플링만이 아님
- 많은 비즈니스 개념이 의미상 여러 시스템 파트를 한데 엮어 기능적으로 응집되어 있음
- 성공적으로 소프트웨어를 설계, 분석, 발전시키기 위해 개발자는 문제가 될만한 커플링 지점을 모두 살펴봐야 함
- 퀀텀(양자)은 상호작용을 하는 모든 물리 입자 가운데 가장 작은 양
#### 아키텍처 퀀텀
- 높은 기능 응집도와 동기적 커네이선스를 가진, 독립적으로 배포 가능한 아티팩트
- 아래의 개념들이 담겨 있음
#### 독립적으로 배포 가능
- 아키텍처 퀀텀은 아키텍처의 다른 파트와 독립적으로 작동되는 모든 필수 컴포넌트를 포함
    - 데이터베이스를 사용하는 애플리케이션은 데이터베이스 없이는 작동되지 않으므로 퀀텀의 일부임
#### 높은 기능 응집도
- 응집도는 컴포넌트 설계에 따라 구현된 코드가 얼마나 목적에 맞게 통합되어 있는지를 나타냄
    - Customer 클래스 : 고객 엔티티와 관련된 모든 프로퍼티와 메서드를 가지고 있으므로 응집도가 높음
    - Utility : 여러 가지 잡다하느 메서드를 무작위로 섞어 놓아서 응집도가 낮음
- 기능 응집도가 높다는 건 아키텍처 퀀텀이 목적에 맞는 뭔가를 하고 있다는 뜻
    - 단일 데이터베이스를 사용하는 기존 모놀리식 애플리케이션에서 이런 구분이 별로 의미가 없음
    - 마이크로서비스 아키텍처는 보통 개발자가 각 서비스를 하나의 워크플로에 맞게 설계하므로 기능 응집도가 높게 나타남
#### 동기적 커네이선스
- 아키텍처 퀀텀을 형성하는 애플리케이션 몬텍스트 내부 또는 분산 서비스 간의 동기 호출을 의미
    - 마이크로서비스 아키텍처에서 어떤 서비스가 다른 서비를 동기 호출할 때, 운영 아키텍처 특성 측면에서 두 서비스는 두드러진 차이를 나타낼 수 없음
    - 호출부가 피호출부보다 확장성이 훨씬 좋다면 타임아웃과 여타 신뢰성 문제가 발생함
    - 동기 호출은 호출의 길이에 대해 동적 커네이선스를 만들어냄
    - 한쪽이 다른 쪽을 기다린다면 호출하는 도중에는 양쪽의 운영 아키텍처 특성이 동일해야 함
- 예시 : Payment 서비스, Auction 서비스
    - Auction 서비스는 경매가 끝나면 Payment 서비스로 결제 정보를 전달
    - Payment 서비스는 매 500밀리초마다 하나의 결제 정보만 처리 가능
    - 엄청 많은 경매가 일시에 종료되면, 타임아웃이 발생할 것
    - Payment, Auction 간에 비동기 통신 링크를 만들고 메세지 큐가 일시적인 버퍼 역할을 수행하도록 하면, 비동기적 커네이선스 덕분에 아키텍처가 한층 더 유연해짐
### 7.2.1 사례 연구: GGG
- GGG 라는 온라인 경매 회사의 아키텍처 카타
#### 설명
- 이 경매 회사는 온라인 경매 시장을 전국적으로 확장하려고 한다
- 고객이 참여할 경매를 선택하고 기다렸다가 경매가 시작되면 마치 처음부터 경매인과 같은 공간에 있었던 것처럼 입찰을 시작한다
#### 유저
- 경매 당 참여자는 수백 명, 어쩌면 수천 명까지 늘어날 수 있고 많은 동시 경매가 이루어질 것
#### 요구사항
- 경매는 가급적 실시간 처리가 가능해야 함
- 입찰자는 낙찰 시 자동 결제할 신용카드를 등록
- 입찰자는 평판 지수로 추적되어야 함
- 입찰자는 라이브 동영상 스트림을 시청하면서 발생하는 모든 입찰을 볼 수 있어야 함
- 온라인/라이브 입찰 모두 입찰이 일어난 순소대로 접수되어야 함
#### 부가 콘텍스트
- 이 경매 회사는 공격적으로 규모가 상대적으로 작은 경쟁사를 인수 합병하여 사세를 키우고 있다
- 예산 제한은 따로 없다, 전략적인 결정
- 이 회사는 위조 혐의로 고발된 소송에서 이제 막 멋어남
1. '전국적인 확장', '경매 당 참여자는 수백 명, 어쩌면 수천 명까지 늘어날 수 있고 많은 동시 경매가 이루어질 것이다.', '경매는 가급적 실시간 처리가 가능해야 한다'
    - 유저 수를 지원하는 확장성과 폭주하는 트래픽을 지원하는 탄력성이 필요함
    - 확장성은 요구사항에 명시
    - 탄력성은 문제 도메인에 따라 암묵적인 특성으로 나타남
    - 아키텍트가 암묵적인 아키텍처 특성을 집어내려면 도메인 지식이 매우 중요함
2. '입찰자는 낙찰 시 자동 결제할 신용카드를 등록한다.', '이 회사는 위조 혐의로 고발된 소송에서 이제 막 벗어났다'
    - 이 두 요구사항은 보안이라는 아키텍처 특성을 분명하게 가리킴
    - 보안은 거의 모든 애플리케이션에 존재하는 암묵적 아키텍처 특성
    - 신용카드 번호를 평문으로 저장하지 않고 데이터를 주고받는 구간에서 암호화를 철저하게 한다면 특별히 보안을 신경쓰지 않아도 됨
3. '입찰자는 평판 지수로 추적되어야 한다'
    - '반낚임성' 같은 별난 이름의 요구사항이라고 볼 수도 있지만, 뭔가를 '추적'한다는 것은 감시성, 로그성 같은 아키텍처 특성
    - 아키텍처 특성을 도출하는 분석이 애플리케이션을 설계/구현하는 모든 노력에서 아주 작은 비중을 차지함
    - 도메인에서 미처 다루지 못한 구조적 영향을 끼칠 만한 요구사항이 있는지 찾아봐야 함
    - 리트머스 시험지
        - 구현을 하려면 도메인 지식이 필요한가, 아니면 추상적인 아키텍처 특성인가
        - 비즈니스 분석가 또는 다른 영역 전문가에게 정확한 의미를 물어볼 것
        - '평판 지수'는 아키텍처 특성에 속하는 표준 정의가 아님
    - 요구사항이 도메인에 포함되어 있는지, 특별한 구조가 필요한지 잘 판단해야 함
4. '이 경매 회사는 공격적으로 규모가 상대적으로 작은 경쟁사를 인수 합병하여 시세를 키우고 있다'
    - 이 요구사항이 설계에 직접적인 영향을 주지는 않지만, 몇 가지 방안의 트레이트오프로 결정 팩터가 될 수 있음
    - ex : 연계 아키텍처에서 어떤 통신 프로토콜을 사용할지 고민중인 아키텍트는 새로 합병된 회사와의 연계에 별 문제가 없을 경우 문제에 고도로 특화된 프로토콜을 자유롭게 선정할 수 있음
5. '예산 제한은 따로 없다. 전략적으로 그렇게 결정됐다'
    - 일반적으로 잘 알려진 실제 트레이드오프를 반영할 목적으로 솔루션에 예산 제약을 가하는 아키텍처 가타도 있음
6. '입찰자는 라이브 동영상 스트림을 시청하면서 발생하는 모든 입찰을 볼 수 있어야 한다', '온라인/라이브 입찰 모두 입찰이 일어난 순서대로 접수되어야 한다'
    - 애플리케이션 구조에도 영향을 미치고, 아키텍처 특성을 시스템의 전체적인 평가로 취급하는 것이 무익함을 잘 보여주는 아키텍처 난제
    - 가용성
        - 아키텍처 전반에 걸쳐 가용성은 균일해야하나
        - 한 입찰자의 가용성이 수백 명의 입찰자 중 한 사람에 대한 가용성보다 더 중요한가
        - 경매인이 사이트에 접속 불가하다면, 어느 누구도 온라인 입찰이 불가능함
        - 신뢰성(총 가동 시간), 데이터 무결성 등이 가용성과 결부되어 있음
    - 경매 사이트는 여러 문제를 제거하고 메시지 순서를 정확히 보장해야 함
- 아키텍트는 아키텍처 퀀텀을 이용해서 아키텍처 퀀텀 레벨에서 아키텍처 특성의 범위를 지정함
- 아키텍트는 아키텍처 퀀텀을 배포, 커플링, 데이터를 둘 장소, 아키텍처 내부 통신 스타일을 생각하는 수단으로써 활용
- GGG에서 발견한 퀀텀과 아키텍처 특성
    - 입찰자 피드백 : 입찰 스트림과 입찰 동영상 스트림을 포함한다.
        - 가용성
        - 확장성
        - 성능
    - 경매인 : 라이브 경매인
        - 가용성
        - 신뢰성
        - 확장성
        - 탄력성
        - 성능
        - 보안
    - 입찰자 : 온라인 입찰자와 입찰
        - 신뢰성
        - 가용성
        - 확장성
        - 탄력성
